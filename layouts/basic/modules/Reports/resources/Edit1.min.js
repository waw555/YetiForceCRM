
Reports_Edit_Js("Reports_Edit1_Js",{},{relatedModulesMapping:false,step1Container:false,secondaryModulesContainer:false,init:function(){this.initialize()},getContainer:function(){return this.step1Container},setContainer:function(a){this.step1Container=a;return this},getSecondaryModuleContainer:function(){if(this.secondaryModulesContainer==false){this.secondaryModulesContainer=jQuery("#secondary_module")}return this.secondaryModulesContainer},initialize:function(a){if(typeof a=="undefined"){a=jQuery("#report_step1")}if(a.is("#report_step1")){this.setContainer(a)}else{this.setContainer(jQuery("#report_step1"))}this.intializeOperationMappingDetails()},intializeOperationMappingDetails:function(){this.relatedModulesMapping=jQuery("#relatedModules").data("value")},getRelatedModulesFromPrimaryModule:function(a){return this.relatedModulesMapping[a]},loadRelatedModules:function(d){var e=this.getRelatedModulesFromPrimaryModule(d);var b="";for(var c in e){if(e.hasOwnProperty(c)){b+='<option value="'+c+'">'+e[c]+"</option>"}}var a=this.getSecondaryModuleContainer();a.html(b).trigger("change")},registerPrimaryModuleChangeEvent:function(){var a=this;jQuery("#primary_module").on("change",function(c){var b=jQuery(c.currentTarget).val();a.loadRelatedModules(b)})},checkDuplicateName:function(c){var a=jQuery.Deferred();var b=app.getModuleName();var d={module:b,action:"CheckDuplicate",reportname:c.reportName,record:c.reportId,isDuplicate:c.isDuplicate};AppConnector.request(d).then(function(g){var f=g.result;var e=f.success;if(e==true){a.reject(f)}else{a.resolve(f)}},function(e,f){a.reject()});return a.promise()},submit:function(){var d=this;var a=jQuery.Deferred();var c=this.getContainer();var f=c.serializeFormData();var g={};var h=jQuery.trim(f.reportname);var b=f.record;var e=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});d.checkDuplicateName({reportName:h,reportId:b,isDuplicate:f.isDuplicate}).then(function(j){AppConnector.request(f).then(function(k){c.hide();e.progressIndicator({mode:"hide"});a.resolve(k)},function(k,l){})},function(k,j){e.progressIndicator({mode:"hide"});g={title:app.vtranslate("JS_DUPLICATE_RECORD"),text:k.message};Vtiger_Helper_Js.showPnotify(g);a.reject()});return a.promise()},registerSelect2ElementForSecondaryModulesSelection:function(){var a=this.getSecondaryModuleContainer();app.changeSelectElementView(a,"select2",{maximumSelectionLength:2})},registerEventForScheduledReprots:function(){var d=this;jQuery('input[name="enable_schedule"]').on("click",function(h){var g=jQuery(h.currentTarget);var f=jQuery("#scheduleBox");if(g.is(":checked")){g.val(g.is(":checked"));f.removeClass("hide")}else{g.val(g.is(":checked"));f.addClass("hide")}});app.registerEventForClockPicker();app.registerEventForDatePickerFields("#scheduleByDate",true);jQuery("#annualDates").chosen();jQuery("#schdayoftheweek").chosen();jQuery("#schdayofthemonth").chosen();jQuery("#recipients").chosen();var b=new Date().getFullYear();var a=jQuery("#weekStartDay").data("value");jQuery("#annualDatePicker").datepick({autoSize:true,firstDay:a,multiSelect:100,monthsToShow:[1,2],minDate:"01/01/"+b,maxDate:"12/31/"+b,yearRange:b+":"+b,onShow:function(){d.removeYearInAnnualReport()},onSelect:function(k){var j=[];var e=[];var h="";var g=jQuery("#annualDates");d.updateAnnualDates(g);for(index in k){var f=k[index];j.push({id:d.DateToYMD(f),text:d.DateToYMD(f)});e.push(d.DateToYMD(f));h+="<option selected value="+d.DateToYMD(f)+">"+d.DateToYMD(f)+"</option>"}g.append(h);g.trigger("chosen:updated")}});var c=jQuery("#annualDates");d.updateAnnualDates(c);c.trigger("chosen:updated")},removeYearInAnnualReport:function(){setTimeout(function(){var b=jQuery(".datepick-month.first").find(".datepick-month-year").get(1);jQuery(b).hide();var a=jQuery(".datepick-month-header");jQuery.each(a,function(c,d){var f=jQuery(d);var e=f.html().replace(/[\d]+/,"");f.html(e)})},100)},updateAnnualDates:function(c){c.html("");var d=jQuery("#hiddenAnnualDates").val();if(d){var a="";var b=JSON.parse(d);for(i in b){a+="<option selected value="+b[i]+">"+b[i]+"</option>"}c.html(a)}},DateToYMD:function(b){var c,d,a;c=String(b.getFullYear());d=String(b.getMonth()+1);if(d.length==1){d="0"+d}a=String(b.getDate());if(a.length==1){a="0"+a}return c+"-"+d+"-"+a},registerEventForChangeInScheduledType:function(){var a=this;jQuery("#schtypeid").on("change",function(d){var b=jQuery(d.currentTarget);var c=b.val();a.showScheduledTime();a.hideScheduledWeekList();a.hideScheduledMonthByDateList();a.hideScheduledAnually();a.hideScheduledSpecificDate();if(c=="2"){a.showScheduledWeekList()}else{if(c=="3"){a.showScheduledMonthByDateList()}else{if(c=="4"){a.showScheduledAnually()}else{if(c=="5"){a.showScheduledSpecificDate()}}}}})},registerEventForRemoveAnnualDates:function(){var a=this;jQuery("#annualDates").chosen().change(function(c){jQuery("#hiddenAnnualDates").val(JSON.stringify(jQuery(c.target).val()));var b=jQuery(c.currentTarget);a.updateAnnualDates(b);b.trigger("chosen:updated")})},hideScheduledTime:function(){jQuery("#scheduledTime").addClass("hide")},showScheduledTime:function(){jQuery("#scheduledTime").removeClass("hide")},hideScheduledWeekList:function(){jQuery("#scheduledWeekDay").addClass("hide")},showScheduledWeekList:function(){jQuery("#scheduledWeekDay").removeClass("hide")},hideScheduledMonthByDateList:function(){jQuery("#scheduleMonthByDates").addClass("hide")},showScheduledMonthByDateList:function(){jQuery("#scheduleMonthByDates").removeClass("hide")},hideScheduledSpecificDate:function(){jQuery("#scheduleByDate").addClass("hide")},showScheduledSpecificDate:function(){jQuery("#scheduleByDate").removeClass("hide")},hideScheduledAnually:function(){jQuery("#scheduleAnually").addClass("hide")},showScheduledAnually:function(){jQuery("#scheduleAnually").removeClass("hide")},registerEvents:function(){this.registerPrimaryModuleChangeEvent();this.registerSelect2ElementForSecondaryModulesSelection();var a=this.getContainer();var b=app.validationEngineOptions;b.onValidationComplete=function(d,c){return c};b.promptPosition="bottomRight";a.validationEngine(b);this.registerEventForScheduledReprots();this.registerEventForChangeInScheduledType();this.registerEventForRemoveAnnualDates()}});