
jQuery.Class("YetiForce_ListSearch_Js",{getInstance:function(c,b){var e=app.getModuleName();var d=e+"_ListSearch_Js";var f="YetiForce_ListSearch_Js";if(typeof window[d]!="undefined"){var a=new window[d](c,b)}else{var a=new window[f](c,b)}return a}},{container:false,init:function(b,a){var c=this;if(typeof b=="undefined"){b=jQuery(".bodyContents")}this.setContainer(b);if(a!=true&&this.getContainer().find('[data-trigger="listSearch"]').length){this.initialize()}},setContainer:function(a){this.container=a},getContainer:function(){return this.container},initialize:function(){this.registerEvents()},getAlphabetSearchField:function(){return jQuery("#alphabetSearchKey").val()},getAlphabetSearchValue:function(){return jQuery("#alphabetValue").val()},registerListSearch:function(){var a=this;var b=this.getContainer();b.find('[data-trigger="listSearch"]').on("click",function(c){a.reloadList()});b.find("input.listSearchContributor").on("keypress",function(c){if(c.keyCode==13){a.triggerListSearch()}});b.find(".removeSearchConditions").on("click",function(){a.reloadList({search_params:[],search_key:"",search_value:"",operator:""})})},registerListViewSelect:function(){var a=this;var b=this.getContainer();b.find(".listViewEntriesTable .select2noactive").each(function(d,e){var c=$(e);if(!c.data("select2")){app.showSelect2ElementView(c,{placeholder:app.vtranslate("JS_SELECT_AN_OPTION")})}});if(app.getMainParams("autoRefreshListOnChange")=="1"){b.find(".listViewEntriesTable select").on("change",function(c){a.triggerListSearch()});b.find(".listViewEntriesTable .dateField").on("DatePicker.onHide",function(d,g){var f=$(this).data("prevVal");var c=$(this).val();if(f!=c){a.triggerListSearch()}});b.find(".clockPicker").on("change",function(){a.triggerListSearch()})}},resetPagination:function(){jQuery("#deSelectAllMsg").trigger("click");jQuery("#recordsCount").val("");jQuery("#pageNumber").val("1");jQuery("#pageToJump").val("1");jQuery("#totalPageCount").text("");jQuery(".pagination").data("totalCount",0)},triggerListSearch:function(){var a=this;var b=a.getContainer();b.find('[data-trigger="listSearch"]').trigger("click")},registerDateListSearch:function(a){var b=this;var c=this.getContainer();c.find(".dateField").each(function(d,e){var g=jQuery(e);var f={calendars:3,mode:"range",className:"rangeCalendar",onChange:function(h){g.data("prevVal",g.val());g.val(h.join(","))},onHide:function(h){g.trigger(jQuery.Event("DatePicker.onHide"),h)}};app.registerEventForDatePickerFields(g,false,f)})},registerTimeListSearch:function(){app.registerEventForClockPicker()},registerAlphabetClick:function(){var a=this;this.getContainer().find(".alphabetBtn").on("click",function(){app.showModalWindow($(".alphabetModal").html(),function(b){a.registerEventForAlphabetSearch(b)})})},getCurrentCvId:function(){return jQuery("#customFilter").find("option:selected").data("id")},registerEventForAlphabetSearch:function(a){var b=this;a.find(".alphabetSearch").on("click",function(h){var g=jQuery(h.currentTarget).find("a").text();var f=b.getCurrentCvId();var c=b.getAlphabetSearchField();var d={viewname:f,search_key:c,search_value:g,operator:"s",page:1};b.resetPagination();b.reloadList(d);app.hideModalWindow()});a.find(".removeAlfabetCondition").on("click",function(){b.reloadList({search_key:"",search_value:"",operator:""});app.hideModalWindow()})},updatePaginationOnAlphabetChange:function(c,a){var b=this;var d={};d.module=app.getModuleName();d.parent=app.getParentModuleName();d.view="Pagination";d.page=1;d.mode="getPagination";d.search_key=a;d.search_value=c;d.operator="s";AppConnector.request(d).then(function(f){jQuery(".paginationDiv").html(f);var e=b.getInstanceView();if(e&&e!=undefined&&jQuery.isFunction(e.registerPageNavigationEvents)){e.registerPageNavigationEvents()}})},getListSearchParams:function(e){var c=this.getContainer();var a=c.find(".listViewEntriesTable");var f=new Array();a.find(".listSearchContributor").each(function(m,l){var i=new Array();var n=jQuery(l);var h=n.data("fieldinfo");var o=n.attr("name");var g=n.val();if(typeof g=="object"){if(g==null){g=""}else{g=g.join(",")}}g=g.trim();if(g.length<=0){return true}var k="c";if(h.hasOwnProperty("searchOperator")){k=h.searchOperator}else{if(jQuery.inArray(h.type,["modules","time","userCreator","owner","picklist","tree","boolean","fileLocationType","userRole"])>=0){k="e"}else{if(h.type=="date"||h.type=="datetime"){k="bw"}else{if(h.type=="currency"||h.type=="double"||h.type=="percentage"||h.type=="integer"||h.type=="number"){k="a"}}}}i.push(o);i.push(k);i.push(g);if(h.type=="tree"){var j=jQuery('.listViewHeaders #searchInSubcategories[data-columnname="'+o+'"]').prop("checked");i.push(j)}f.push(i)});if(e){var d=null;var b=app.getUrlVar("search_params");if(b!=undefined&&b.length){b=jQuery.parseJSON(decodeURIComponent(b));$.each(b[0],function(g,i){var h=false;$.each(f,function(j,k){if(k[0]==i[0]){h=true}});d=a.find('.listSearchContributor[name="'+i[0]+'"]').val();if(h==false&&d!=""&&d!==null){f.push(i)}})}}return new Array(f)},getInstanceByView:function(){var b=app.getViewName();var a=false;if(b==="Detail"){a=Vtiger_Detail_Js.getInstance();a.reloadFunctionName="loadRelatedList"}else{if(b=="List"){a=new Vtiger_List_Js();a.reloadFunctionName="getListViewRecords";a.execute=["updatePagination"]}}return a},reloadList:function(d){var b=this;if(d==undefined){d={page:1}}var a=this.getInstanceByView();if(a){var c=a.reloadFunctionName;if(jQuery.isFunction(a[c])){a[c](d).then(function(){b.resetPagination();b.executeFunctions(a)})}}},executeFunctions:function(a){var d=this;if(a.execute){var c=a.execute;for(var b in c){var e=c[b];if(jQuery.isFunction(a[e])){a[e]()}}}},registerBasicEvents:function(){this.registerListViewSelect();this.registerDateListSearch();this.registerTimeListSearch();this.registerAlphabetClick();this.registerListSearch();this.getContainer().find("select.select2").each(function(a,b){if(!$(b).data("select2")){app.showSelect2ElementView($(b))}})},registerEvents:function(){this.registerBasicEvents()}});